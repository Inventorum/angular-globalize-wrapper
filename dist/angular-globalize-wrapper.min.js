/* angular-globalize-wrapper - v0.2.0 - 2016-01-26
   Copyright (c) 2016 Ross Basarevych; Licensed MIT */

"use strict";var glModule=angular.module("globalizeWrapper",[]),globalizeInstances={},localeChanged=!1,mainLoaded=!0,supplementalLoaded=!1,messagesLoaded=!1,mainData=[],supplementalData=[],messagesData={};glModule.provider("globalizeWrapper",function(){var a="bower_components/cldr-data",b="l10n",c=!0,d=["currencies.json","ca-gregorian.json","timeZoneNames.json","numbers.json"],e=["currencyData.json","likelySubtags.json","plurals.json","timeData.json","weekData.json"];this.$get=["$q","$http","$rootScope",function(b,f,g){function h(a,c,d){for(var e=[],h=0;h<c.length;h++)e.push(f.get(a+"/"+c[h]));b.all(e).then(d)["catch"](function(){g.$broadcast("GlobalizeLoadError")})}function i(){return mainLoaded&&supplementalLoaded&&(!c||messagesLoaded)}function j(b){if(l==b)return void k();if(localeChanged=!1,l=b,"undefined"!=typeof globalizeInstances[l])return void k();var c=new Cldr(b),e=c.attributes.bundle;console.log("Cldr 1 bundle name is: "+e),mainLoaded=!1,h(a+"/main/"+e,d,function(a){for(var b=0;b<a.length;b++)Globalize.load(a[b].data);mainLoaded=!0,k()})}function k(){if(i()){if(localeChanged=!0,"undefined"==typeof globalizeInstances[l]){var a=null;l&&(a=Globalize(l)),globalizeInstances[l]=a}g.$broadcast("GlobalizeLoadSuccess")}}var l=null;return supplementalLoaded?k():f.get(a+"/availableLocales.json").then(function(b){var c=b.data.availableLocales;Cldr._availableBundleMapQueue=c.filter(function(a){return"root"!=a}),h(a+"/supplemental",e,function(a){for(var b=0;b<a.length;b++)Globalize.load(a[b].data);supplementalLoaded=!0,k()})}),{isLoaded:i,setLocale:j,getLocale:function(){return l},getGlobalize:function(a){return"undefined"==typeof a&&(a=l),globalizeInstances[a]},hasMessage:function(a,b){return"undefined"==typeof b&&(b=l),"undefined"!=typeof messagesData[b][a]}}}],this.setCldrBasePath=function(b){a=b},this.setL10nBasePath=function(a){b=a},this.setL10nEnabled=function(a){c=a},this.setMainResources=function(a){d=a},this.setSupplementalResources=function(a){e=a}}),glModule.filter("glDate",["globalizeWrapper",function(a){return function(b,c){if(!angular.isUndefined(b)&&!angular.isUndefined(c)){if(0==b.length||!a.isLoaded())return"";var d=a.getGlobalize();return d?d.formatDate(b,c):b}}}]),glModule.filter("glMessage",["globalizeWrapper",function(a){return function(b,c){if(!angular.isUndefined(b)){if(0==b.length||!a.isLoaded())return"";if(!a.hasMessage(b))return console.log("Missing translation: "+b),b;var d=a.getGlobalize();return d?d.formatMessage(b,c):b}}}]),glModule.filter("glNumber",["globalizeWrapper",function(a){return function(b,c){if(!angular.isUndefined(b)){if(0==b.length||!a.isLoaded())return"";var d=a.getGlobalize();return d?d.formatNumber(b,c):b}}}]),glModule.filter("glCurrency",["globalizeWrapper",function(a){return function(b,c,d){if(!angular.isUndefined(b)&&!angular.isUndefined(c)){if(0==b.length||!a.isLoaded())return"";var e=a.getGlobalize();return e?e.formatCurrency(b,c,d):b}}}]);